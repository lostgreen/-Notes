# 分布式数据库体系结构

## 分布式数据库体系结构概述

### 分布式数据库体系结构需求

- 数据分布存储
- 异构环境中数据集成的需求（异构数据指的是不同数据库当中存储的数据格式不同）
- 数据库设计方案信息系统集成的需求

### 分布式数据库体系结构系统技术特色

- 拓展了数据独立性：除了逻辑独立性和物理独立性，还具备数据分布独立性（数据分布独立性是分布式数据库系统中特有的一种独立性，它允许数据在不同的物理位置进行分布存储，而不影响用户的访问。）
- 集中与自治相结合的数据结构：局部DBMS可独立自治的管理局部数据库；系统也设有集中控制机制以协调各局部DBMS的工作，从而完成全局应用。
- 适当增加了数据冗余度：通过适当增加数据冗余可以方便检索，减少通信代价，提高系统的查询速度。（数据冗余即相同的数据可以在多个节点上存在副本）
- 全局的一致性：可串行性和可恢复性

### 分布式数据库体系结构系统模式结构

![系统模式](imgs/image_3.png)
分布式数据库系统的模式结构主要包括以下几个层次：

1. **全局外模式（Global External Schema）**：
   - 这是最终用户或应用程序所看到的数据库视图，代表了全局应用的视图。全局外模式是全局概念模式的一个子集，它为用户提供了一个统一的数据访问接口，隐藏了数据的物理分布细节。

2. **全局概念模式（Global Conceptual Schema）**：
   - 定义了分布式数据库中数据的整体逻辑结构，使得数据在逻辑上看起来像一个没有分布的单一数据库。全局概念模式通常采用关系模型，并包括一组全局关系的定义。

3. **分片模式（Fragmentation Schema）**：
   - 描述了如何将全局关系划分为多个逻辑片段（Fragment），以及这些片段之间的映射关系。分片模式可以是一对多的，即一个全局关系可以对应多个片段，而一个片段只来自一个全局关系。

4. **分配模式（Allocation Schema）**：
   - 定义了片段在物理上的存储位置，即哪些片段存放在网络的哪些节点上。分布模式的映像类型决定了分布式数据库是冗余的还是非冗余的。如果一个片段可以分配到多个节点上，则是冗余的分布式数据库；如果一个片段只分配到一个节点上，则是一个非冗余的分布式数据库。

5. **局部概念模式（Local Conceptual Schema）**：
   - 描述了分布式数据库中局部数据的逻辑结构，是全局概念模式的子集。每个局部数据库系统都有自己的局部概念模式，用于描述和管理本地存储的数据。

6. **局部内模式（Local Conceptual Schema）**：
   - 每个节点或局部数据库所维护的数据的逻辑结构和组织方式。它描述了局部数据库中数据的逻辑视图，包括数据的类型、结构、关系以及数据之间的约束等。局部内模式是数据库的逻辑结构在特定节点上的体现，它为局部数据库的设计和操作提供了基础。

分布式数据库系统中的映像包括：

- **从全局外模式到全局概念模式的映像**：这个映像保证了数据的逻辑独立性。
- **从全局概念模式到分片模式的映像**：这个映像定义了全局关系如何被划分为片段。
- **从分片模式到分配模式的映像**：这个映像定义了片段如何被分配到网络的不同节点上。
- **从分配模式到局部概念模式的映像**：这个映像把存储在局部场地的全局关系或全局关系的片段映像为各局部概念模式。
- **从局部概念模式到局部内模式的映像**：局部数据库的逻辑结构映射到物理存储结构的映像。

数据独立性在分布式数据库系统中的体现：

- **逻辑独立性**：用户的应用程序与数据库的逻辑结构无关，即改变数据库的逻辑结构不会影响到应用程序。
- **物理独立性**：用户的应用程序与数据库的存储结构无关，即改变数据库的存储结构不会影响到应用程序。
- **数据分布独立性（分布透明性）**：用户不必关心数据的物理分布细节，包括数据的逻辑分片、物理位置分布、重复副本的一致性问题等。这种透明性使用户能够像操作本地数据一样操作分布式数据库中的数据，而无需关心数据的具体存储位置和分布情况。

分布式数据库系统通过这种多层次的模式结构和映像机制，实现了数据的分布透明性，使得用户可以像使用集中式数据库一样使用分布式数据库，而无需关心数据的分布和复制等细节。

## 分布式事务系统结构

### 事务的分类

- 局部事务：访问、更新局部分布式系统中的某个数据库就能完成的事务。
- 全局事务：需要访问、更新分布式数据库系统中的多个数据库才能完成的事务。

### 分布式事务系统结构概述

- 事务管理器：每个节点都有独立的管理器，保证节点内的局部事务的ACID特性
  - 维护用于恢复目的的日志
  - 参与协调在本地执行的事务的并发

- 事务协调器：负责协调节点间不同事务的处理
  - 启动本地发起的事务
  - 将子事务分配到适当场地执行
  - 协调本地发起事务的终止过程, 使事务在所有场地上提交或夭折

- 故障
  - 传统集中式系统故障：事务、系统和介质故障
  - 分布式环境下特有的故障：比如场地故障（某个节点内发生），消息传递丢失，通信连接故障，网络分割（当网络被分裂成两个或更多相互不连通的子系统）

事务在一个场地上提交而在另一个场地上夭折是不可接受的。为此事务系统采用了两段提交协议和三段提交协议来保障事务的原子性。

## 并发控制

## 异构与基于云的分布式数据库

## 分布式目录系统
